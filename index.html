<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SK Kostelec nad Černými lesy | Oficiální stránky</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .main-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .karvina-box { background: #fff; border-radius: 12px; padding: 25px; display: flex; align-items: center; justify-content: space-around; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin: 20px 0 40px 0; border: 1px solid #eee; }
        .kb-team { flex: 1; font-weight: bold; font-size: 1.1rem; }
        .kb-logo { width: 70px; height: 70px; object-fit: contain; }
        .kb-center { flex: 1; border-left: 1px solid #eee; border-right: 1px solid #eee; margin: 0 15px; }
        .kb-time { font-size: 2.2rem; font-weight: 900; color: #0033ff; line-height: 1; margin-bottom: 5px; }
        .kb-info { font-size: 0.85rem; color: #777; }
        .kb-label { font-size: 0.75rem; text-transform: uppercase; color: #999; margin-bottom: 10px; }
        
        .content-layout { display: flex; gap: 30px; align-items: flex-start; }
        .news-section { flex: 1.2; }
        .sidebar-section { flex: 2; min-width: 480px; }

        .table-wrapper { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; }
        
        .table-responsive {
            width: 100%;
            overflow-x: auto !important;
            display: block !important;
            -webkit-overflow-scrolling: touch;
        }

        .league-table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
        .league-table th, .league-table td { padding: 10px 8px; text-align: center; border-bottom: 1px solid #f2f2f2; white-space: nowrap; }
        .league-table th { color: #666; font-weight: bold; text-transform: uppercase; font-size: 0.75rem; }
        .league-table td:nth-child(2) { text-align: left; min-width: 180px; }
        .league-table img { width: 18px; height: 18px; object-fit: contain; vertical-align: middle; margin-right: 6px; }
        .highlight-kostelec { background-color: #fff4b3 !important; font-weight: bold; }
        
        .article-row { display: flex; gap: 15px; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .art-img { width: 100px; height: 65px; background-size: cover; background-position: center; border-radius: 6px; flex-shrink: 0; }
        .art-text h3 { margin: 0; font-size: 1rem; line-height: 1.3; }

        .partners-section { width: 100%; padding: 60px 0; margin-top: 40px; border-top: 1px solid rgba(0,0,0,0.06); }
        .partners-title { text-align: center; font-size: 1.2rem; font-weight: 900; color: #666; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 40px; }
        .partners-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; align-items: center; gap: 80px; padding: 0 20px; }
        .partners-container a { display: block; transition: transform 0.3s; }
        .partners-container a:hover { transform: scale(1.15); }
        .partners-container img { height: 80px; width: auto; object-fit: contain; display: block; }
        
        @media (max-width: 768px) {
            .sidebar-section { min-width: 100%; }
            .content-layout { flex-direction: column; }
        }
    </style>
</head>
<body>

    <header>
        <nav class="navbar">
            <div class="logo-container">
                <img src="logo-sk-kostelec.png" alt="Logo SK Kostelec" class="main-logo">
            </div>
            <button class="menu-toggle" aria-label="Otevřít menu">
                <span></span><span></span><span></span>
            </button>
            <ul class="nav-links">
                <li><a href="index.html">Aktuality</a></li>
                <li><a href="soupiska.html">A-Tým</a></li>
                <li><a href="klub.html">Klub</a></li>
                <li><a href="kontakt.html">Kontakt</a></li>
            </ul>
        </nav>
    </header>

    <div class="top-news-grid" id="top-news-feed"></div>

    <main class="main-container">
        <section class="karvina-box" id="next-match-box">
            <div class="kb-team" id="nm-home-name">Načítám...</div>
            <img src="logo-sk-kostelec.png" id="nm-home-logo" class="kb-logo">
            <div class="kb-center">
                <div class="kb-label">Příští utkání</div>
                <div class="kb-time" id="nm-time">--:--</div>
                <div class="kb-info" id="nm-info">Hledám zápas...</div>
            </div>
            <img src="logo-sk-kostelec.png" id="nm-away-logo" class="kb-logo">
            <div class="kb-team" id="nm-away-name">Načítám...</div>
        </section>

        <div class="content-layout">
            <section class="news-section">
                <h2 class="section-title">Nejnovější zprávy</h2>
                <div id="news-feed"></div>
            </section>

            <aside class="sidebar-section">
                <h2 class="section-title">Tabulka A-Třída</h2>
                <div class="table-wrapper">
                    <div class="table-responsive" id="league-scroll-container">
                        <table class="league-table" id="league-table-element">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th style="text-align:left">Tým</th>
                                    <th>Z</th><th>V</th><th>R</th><th>P</th><th>Skóre</th><th>B</th>
                                </tr>
                            </thead>
                            <tbody id="auto-league-table"><tr><td colspan="8">Načítám tabulku...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <section class="partners-section">
        <h3 class="partners-title">Naši partneři</h3>
        <div class="partners-container">
            <a href="#"><img src="assets/images/sponsors/msmt.png" alt="MŠMT"></a>
            <a href="#"><img src="assets/images/sponsors/NSA.png" alt="NSA"></a>
            <a href="#"><img src="assets/images/sponsors/sportfotbal_logo.png" alt="SportFotbal"></a>
        </div>
    </section>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <img src="logo-sk-kostelec.png" alt="SK Kostelec" class="footer-logo">
                    <p>Tradiční fotbalový klub založený v roce 1921. Zakládáme si na výchově mládeže a férovém sportovním prostředí.</p>
                </div>
                <div class="footer-col">
                    <h4>Navigace</h4>
                    <ul>
                        <li><a href="index.html">Aktuality</a></li>
                        <li><a href="soupiska.html">A-Tým</a></li>
                        <li><a href="klub.html">Klub</a></li>
                        <li><a href="kontakt.html">Kontakt</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Kontakt</h4>
                    <p><strong>Adresa:</strong> Sportovní 752, 281 63 Kostelec nad Černými lesy</p>
                    <p><strong>Email:</strong> skkostelec@seznam.cz</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 SK Kostelec nad Černými lesy. Všechna práva vyhrazena.</p>
            </div>
        </div>
    </footer>

    <button id="backToTop" title="Nahoru">↑</button>

    <script>
        const REPO = 'karabinaification-droid/sk-kostelec-web';
        const IS_LOCAL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

        async function getGitHubData(path) {
            try {
                const url = `https://api.github.com/repos/${REPO}/contents/${path}`;
                const res = await fetch(url);
                return res.ok ? await res.json() : [];
            } catch (e) { return []; }
        }

        async function fetchJSON(url) {
            try {
                const res = await fetch(url);
                return res.ok ? await res.json() : null;
            } catch (e) { return null; }
        }

        async function init() {
            await loadNews();
            await autoNextMatch();
            await generateAutoTable();
        }

        // 1. AUTOMATICKÉ NOVINKY
        async function loadNews() {
            const feed = document.getElementById('news-feed');
            const topFeed = document.getElementById('top-news-feed');
            try {
                const files = await getGitHubData('_posts');
                const allPosts = [];

                for (const file of files) {
                    const r = await fetch(IS_LOCAL ? `./_posts/${file.name}` : file.download_url);
                    if(!r.ok) continue;
                    const raw = await r.text();
                    const metaPart = raw.split('---')[1];
                    const contentPart = raw.split('---')[2] || "";
                    
                    const getMeta = (key) => {
                        const regex = new RegExp(`${key}:\\s*["']?(.*?)["']?$`, 'm');
                        const match = metaPart.match(regex);
                        return match ? match[1].trim() : null;
                    };

                    const post = {
                        filename: file.name,
                        title: getMeta('title'),
                        type: getMeta('type'),
                        image: getMeta('image') || 'logo-sk-kostelec.png',
                        date: getMeta('date') || "20. února 2026",
                        description: contentPart.replace(/[#*`]/g, '').substring(0, 150).trim() + '...'
                    };
                    if (post.title) allPosts.push(post);
                }

                allPosts.sort((a, b) => b.filename.localeCompare(a.filename));
                const featured = allPosts.filter(p => p.type === 'featured').slice(0, 3);
                const regular = allPosts.filter(p => p.type !== 'featured').slice(0, 5);

                topFeed.innerHTML = featured.map(p => `
                    <div class="tn-card-wrapper" onclick="window.location.href='clanek.html?id=${p.filename}'">
                        <div class="top-news-card" style="background-image: url('${p.image}')">
                            <div class="tn-overlay">
                                <div class="tn-content">
                                    <h3 class="tn-title">${p.title}</h3>
                                    <p class="tn-excerpt">${p.description}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

                feed.innerHTML = regular.map(p => `
                    <article class="article-row" style="cursor:pointer" onclick="window.location.href='clanek.html?id=${p.filename}'">
                        <div class="art-img" style="background-image: url('${p.image}')"></div>
                        <div class="art-text"><h3>${p.title}</h3></div>
                    </article>
                `).join('');
            } catch(e) { console.error(e); }
        }

        // 2. AUTOMATICKÝ PŘÍŠTÍ ZÁPAS
        async function autoNextMatch() {
            try {
                const matchFiles = await getGitHubData('_data/matches');
                let matches = [];
                for (let f of matchFiles) {
                    const m = await fetchJSON(IS_LOCAL ? `./_data/matches/${f.name}` : f.download_url);
                    if (m && !m.played) matches.push(m);
                }

                if (matches.length > 0) {
                    matches.sort((a, b) => new Date(a.date) - new Date(b.date));
                    const next = matches[0];
                    
                    const hTeam = await fetchJSON(IS_LOCAL ? `./_data/teams/${next.home_id}.json` : `https://raw.githubusercontent.com/${REPO}/main/_data/teams/${next.home_id}.json`);
                    const aTeam = await fetchJSON(IS_LOCAL ? `./_data/teams/${next.away_id}.json` : `https://raw.githubusercontent.com/${REPO}/main/_data/teams/${next.away_id}.json`);

                    document.getElementById('nm-home-name').innerText = hTeam ? hTeam.title : next.home_id;
                    document.getElementById('nm-away-name').innerText = aTeam ? aTeam.title : next.away_id;
                    document.getElementById('nm-home-logo').src = hTeam ? hTeam.logo : 'logo-sk-kostelec.png';
                    document.getElementById('nm-away-logo').src = aTeam ? aTeam.logo : 'logo-sk-kostelec.png';
                    
                    const d = new Date(next.date);
                    document.getElementById('nm-time').innerText = d.toLocaleTimeString('cs-CZ', {hour: '2-digit', minute:'2-digit'});
                    document.getElementById('nm-info').innerText = `${d.toLocaleDateString('cs-CZ')} | ${next.location}`;
                } else {
                    document.getElementById('nm-info').innerText = "Žádný naplánovaný zápas";
                }
            } catch(e) {}
        }

        // 3. AUTOMATICKÁ TABULKA
        async function generateAutoTable() {
            const tb = document.getElementById('auto-league-table');
            try {
                const teamFiles = await getGitHubData('_data/teams');
                let stats = {};
                for (const file of teamFiles) {
                    const t = await fetchJSON(IS_LOCAL ? `./_data/teams/${file.name}` : file.download_url);
                    if (t) stats[t.id] = { title: t.title, logo: t.logo, z: 0, v: 0, r: 0, p: 0, gf: 0, ga: 0, b: 0 };
                }

                const matchFiles = await getGitHubData('_data/matches');
                for (const file of matchFiles) {
                    const m = await fetchJSON(IS_LOCAL ? `./_data/matches/${file.name}` : file.download_url);
                    if (m && m.played && stats[m.home_id] && stats[m.away_id]) {
                        const h = stats[m.home_id], a = stats[m.away_id];
                        h.z++; a.z++;
                        h.gf += parseInt(m.home_score); h.ga += parseInt(m.away_score);
                        a.gf += parseInt(m.away_score); a.ga += parseInt(m.home_score);
                        if (parseInt(m.home_score) > parseInt(m.away_score)) { h.v++; h.b += 3; a.p++; }
                        else if (parseInt(m.home_score) < parseInt(m.away_score)) { a.v++; a.b += 3; h.p++; }
                        else { h.r++; a.r++; h.b += 1; a.b += 1; }
                    }
                }

                const sorted = Object.values(stats).sort((a,b) => b.b - a.b || (b.gf-b.ga)-(a.gf-a.ga));
                tb.innerHTML = sorted.slice(0, 14).map((t, i) => {
                    const isK = t.title.toLowerCase().includes("kostelec") && !t.title.toLowerCase().includes("křížků") ? 'class="highlight-kostelec"' : '';
                    return `<tr ${isK}><td>${i+1}.</td><td style="text-align:left"><img src="${t.logo}">${t.title}</td><td>${t.z}</td><td>${t.v}</td><td>${t.r}</td><td>${t.p}</td><td>${t.gf}:${t.ga}</td><td>${t.b}</td></tr>`;
                }).join('');
            } catch(e) { tb.innerHTML = 'Chyba načítání.'; }
        }
        
        init();

        const menuToggle = document.querySelector('.menu-toggle');
        const navLinks = document.querySelector('.nav-links');
        menuToggle.addEventListener('click', () => {
            menuToggle.classList.toggle('active');
            navLinks.classList.toggle('active');
        });
    </script>
</body>
</html>